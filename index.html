<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯é€±å­¸ç”Ÿè¨‚é¤ç³»çµ±</title>
    <style>
        /* æ¨£å¼ä¿æŒä¸è®Šï¼Œç‚ºäº†ç‰ˆé¢æ•´æ½”é€™è£¡çœç•¥é‡è¤‡çš„ CSSï¼Œç›´æ¥ä½¿ç”¨å³å¯ */
        :root { --primary-color: #4CAF50; --bg-color: #f4f4f9; }
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; margin: 0; padding: 20px; background-color: var(--bg-color); display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 800px; width: 100%; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .tabs { display: flex; justify-content: space-around; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab-btn { padding: 10px 20px; border: none; background: none; cursor: pointer; font-size: 16px; font-weight: bold; color: #666; }
        .tab-btn.active { color: var(--primary-color); border-bottom: 3px solid var(--primary-color); }
        .menu-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .food-card { border: 1px solid #eee; border-radius: 8px; padding: 15px; text-align: center; transition: transform 0.2s; }
        .food-card:hover { transform: translateY(-3px); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .food-name { font-size: 1.1em; margin-bottom: 5px; font-weight: bold; }
        .food-price { color: #e91e63; font-weight: bold; }
        .add-btn { margin-top: 10px; padding: 5px 15px; background-color: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer; }
        .add-btn:hover { background-color: #45a049; }
        .cart-section { margin-top: 30px; padding-top: 20px; border-top: 2px dashed #ccc; }
        .cart-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #f0f0f0; }
        .total-price { text-align: right; font-size: 1.2em; font-weight: bold; margin-top: 10px; color: #333; }
        .submit-area { margin-top: 20px; text-align: center; }
        input[type="text"] { padding: 10px; width: 60%; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 10px; }
        .checkout-btn { padding: 10px 30px; background-color: #2196F3; color: white; border: none; border-radius: 5px; font-size: 1.1em; cursor: pointer; width: 100%; transition: background-color 0.3s; }
        .checkout-btn:disabled { background-color: #ccc; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ± å­¸ç”Ÿåˆé¤è¨‚è³¼ç³»çµ±</h1>
    <p style="text-align:center; color:#666;">è«‹é¸æ“‡æ˜ŸæœŸæŸ¥çœ‹èœå–®</p>

    <div class="tabs" id="dayTabs"></div>
    <div id="menuContainer" class="menu-list"></div>

    <div class="cart-section">
        <h3>ğŸ›’ æˆ‘çš„è¨‚å–®</h3>
        <div id="cartItems"><p style="color:#999; text-align:center;">å°šæœªé¸æ“‡é¤é»</p></div>
        <div class="total-price">ç¸½è¨ˆ: $<span id="totalPrice">0</span></div>
        
        <div class="submit-area">
            <input type="text" id="studentName" placeholder="è«‹è¼¸å…¥ç­ç´šåº§è™Ÿå§“å (ä¾‹: 301-05 ç‹å°æ˜)">
            <button id="submitBtn" class="checkout-btn" onclick="submitOrder()">é€å‡ºè¨‚å–®</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // ğŸš¨ è¨­å®šå€åŸŸï¼šè«‹å°‡é€™è£¡çš„ç¶²å€æ›æˆä½ çš„ Web App URL
    // ==========================================
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyZIjAEVjP2TVqfE9mMLMdBKlx40W7-jivNomG9p_nqiWUJ_zEUyBuirkKLHYf4WxHE/exec"
    // ==========================================

 const weeklyMenu = {
        "é€±ä¸€": [
            { name: "é¦™æ»·é›è…¿é£¯", price: 80 },
            { name: "å’–å“©è±¬æ’é£¯", price: 85 },
            { name: "ç´ é£Ÿç‡´é£¯", price: 70 },
            { name: "âŒ ä¸è¨‚é¤", price: 0 }  // æ–°å¢é€™è¡Œ
        ],
        "é€±äºŒ": [
            { name: "ç´…ç‡’ç‰›è…©é£¯", price: 90 },
            { name: "ç‚¸é­šæ’ä¾¿ç•¶", price: 80 },
            { name: "ç•ªèŒ„è›‹ç‚’é£¯", price: 65 },
            { name: "âŒ ä¸è¨‚é¤", price: 0 }  // æ–°å¢é€™è¡Œ
        ],
        "é€±ä¸‰": [
            { name: "å¿«æ¨‚å…’ç«¥é¤", price: 100 },
            { name: "è‚‰ç‡¥ä¹¾éºµ+æ¹¯", price: 60 },
            { name: "è”¬èœæ‹Œé£¯", price: 60 },
            { name: "âŒ ä¸è¨‚é¤", price: 0 }  // æ–°å¢é€™è¡Œ
        ],
        "é€±å››": [
            { name: "ç…§ç‡’é›è‚‰é£¯", price: 80 },
            { name: "é»‘èƒ¡æ¤’è±¬æŸ³", price: 85 },
            { name: "ä»€éŒ¦æ¹¯éºµ", price: 70 },
            { name: "âŒ ä¸è¨‚é¤", price: 0 }  // æ–°å¢é€™è¡Œ
        ],
        "é€±äº”": [
            { name: "å¡æ‹‰é›è…¿å ¡", price: 75 },
            { name: "ç¾©å¤§åˆ©è‚‰é†¬éºµ", price: 80 },
            { name: "æ°´æœæ²™æ‹‰é¤", price: 70 },
            { name: "âŒ ä¸è¨‚é¤", price: 0 }  // æ–°å¢é€™è¡Œ
        ]
    };
    let currentDay = "é€±ä¸€";
    let cart = [];

    function init() {
        const tabsContainer = document.getElementById('dayTabs');
        const days = Object.keys(weeklyMenu);
        days.forEach((day, index) => {
            const btn = document.createElement('button');
            btn.className = `tab-btn ${index === 0 ? 'active' : ''}`;
            btn.innerText = day;
            btn.onclick = () => switchTab(day, btn);
            tabsContainer.appendChild(btn);
        });
        renderMenu(days[0]);
    }

    function switchTab(day, btn) {
        currentDay = day;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderMenu(day);
    }

    function renderMenu(day) {
        const container = document.getElementById('menuContainer');
        container.innerHTML = '';
        weeklyMenu[day].forEach(item => {
            const card = document.createElement('div');
            card.className = 'food-card';
            card.innerHTML = `
                <div class="food-name">${item.name}</div>
                <div class="food-price">$${item.price}</div>
                <button class="add-btn" onclick="addToCart('${day}', '${item.name}', ${item.price})">åŠ å…¥</button>
            `;
            container.appendChild(card);
        });
    }

    function addToCart(day, name, price) {
        cart.push({ day, name, price });
        updateCartUI();
    }

    function updateCartUI() {
        const cartContainer = document.getElementById('cartItems');
        const totalSpan = document.getElementById('totalPrice');
        if (cart.length === 0) {
            cartContainer.innerHTML = '<p style="color:#999; text-align:center;">å°šæœªé¸æ“‡é¤é»</p>';
            totalSpan.innerText = '0';
            return;
        }
        let html = '';
        let total = 0;
        cart.forEach((item, index) => {
            html += `<div class="cart-item"><span>[${item.day}] ${item.name}</span><span>$${item.price} <a href="#" onclick="removeFromCart(${index})" style="color:red;text-decoration:none;margin-left:10px;">âœ•</a></span></div>`;
            total += item.price;
        });
        cartContainer.innerHTML = html;
        totalSpan.innerText = total;
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        updateCartUI();
    }

    // ==========================================
    // ğŸš€ é€å‡ºè¨‚å–®çš„æ ¸å¿ƒé‚è¼¯ (é€£å‹• Google Sheet)
    // ==========================================
    function submitOrder() {
        const name = document.getElementById('studentName').value;
        const submitBtn = document.getElementById('submitBtn');

        if (GOOGLE_SCRIPT_URL.includes("ä½ çš„_Google_Apps_Script_ç¶²å€")) {
            alert("âš ï¸ éŒ¯èª¤ï¼šä½ é‚„æ²’æœ‰åœ¨ç¨‹å¼ç¢¼ä¸­è²¼ä¸Š Google Script çš„ç¶²å€å–”ï¼");
            return;
        }
        if (!name) { alert('è«‹è¼¸å…¥ç­ç´šåº§è™Ÿå§“åï¼'); return; }
        if (cart.length === 0) { alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„å–”ï¼'); return; }

        // 1. æº–å‚™è³‡æ–™
        const orderData = {
            name: name,
            cart: cart,
            total: parseInt(document.getElementById('totalPrice').innerText)
        };

        // 2. é–å®šæŒ‰éˆ•é¿å…é‡è¤‡ç™¼é€
        submitBtn.disabled = true;
        submitBtn.innerText = "è³‡æ–™å‚³é€ä¸­...";

        // 3. ç™¼é€è³‡æ–™åˆ° Google Sheet
        // ä½¿ç”¨ text/plain æ˜¯ç‚ºäº†é¿å…è·¨åŸŸ (CORS) çš„è¤‡é›œå•é¡Œï¼Œé€™æ˜¯ Google Apps Script çš„å°æŠ€å·§
        fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(orderData),
            headers: { 'Content-Type': 'text/plain;charset=utf-8' }, 
        })
        .then(response => response.json())
        .then(data => {
            if(data.result === 'success'){
                alert(`âœ… è¨‚è³¼æˆåŠŸï¼\n\n${name} çš„è¨‚å–®å·²é€å‡ºã€‚`);
                // æ¸…ç©ºè³¼ç‰©è»Š
                cart = [];
                updateCartUI();
                document.getElementById('studentName').value = '';
            } else {
                alert('âŒ ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('âŒ é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–è¯çµ¡ç®¡ç†å“¡ã€‚');
        })
        .finally(() => {
            // æ¢å¾©æŒ‰éˆ•
            submitBtn.disabled = false;
            submitBtn.innerText = "é€å‡ºè¨‚å–®";
        });
    }

    init();
</script>

</body>
</html>
